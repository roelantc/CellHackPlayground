/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";let e,t,i=()=>{},s={};function n(e,...t){(s[e]||[]).map((e=>e(...t)))}let r={get:(e,t)=>"_proxy"==t||i};function o(){return t}function h(e,t,i){return Math.min(Math.max(e,i),t)}class l{constructor(e=0,t=0,i={}){null!=e.x?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=e,this.y=t)}set(e){this.x=e.x,this.y=e.y}add(e){return new l(this.x+e.x,this.y+e.y,this)}subtract(e){return new l(this.x-e.x,this.y-e.y,this)}scale(e){return new l(this.x*e,this.y*e)}normalize(e=this.length()||1){return new l(this.x/e,this.y/e)}dot(e){return this.x*e.x+this.y*e.y}length(){return Math.hypot(this.x,this.y)}distance(e){return Math.hypot(this.x-e.x,this.y-e.y)}angle(e){return Math.acos(this.dot(e)/(this.length()*e.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(e,t,i,s){this._c=!0,this._a=e,this._b=t,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(e){this._x=this._c?h(this._a,this._d,e):e}set y(e){this._y=this._c?h(this._b,this._e,e):e}}function c(){return new l(...arguments)}function a(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}new WeakMap;const v=(e="div")=>document.createElement(e),d=v();d.id="game-container",d.classList.add("container");let y=document.getElementById("game-scene");var p;y?.append(d),function(e){e[e.Rest=1]="Rest",e[e.Nothing=2]="Nothing",e[e.Die=3]="Die",e[e.EatUp=4]="EatUp",e[e.EatDown=5]="EatDown",e[e.EatLeft=6]="EatLeft",e[e.EatRight=7]="EatRight",e[e.MoveUp=8]="MoveUp",e[e.MoveDown=9]="MoveDown",e[e.MoveLeft=10]="MoveLeft",e[e.MoveRight=11]="MoveRight",e[e.SplitUp=12]="SplitUp",e[e.SplitDown=13]="SplitDown",e[e.SplitLeft=14]="SplitLeft",e[e.SplitRight=15]="SplitRight",e[e.FeedUp=16]="FeedUp",e[e.FeedDown=17]="FeedDown",e[e.FeedLeft=18]="FeedLeft",e[e.FeedRight=19]="FeedRight"}(p||(p={}));let w=50,m=50;const g=200;class u{static setMapSize(e,t){w=e,m=t}}var f;!function(e){e[e.Rock=0]="Rock",e[e.Player=1]="Player"}(f||(f={}));const x=[];class E{width;height;htmlElement;type;energy;vector;color;constructor(e,t,i=f.Rock,s="#ff1100"){this.vector=e,e.clamp(0,0,w,m),this.width=10,this.height=10,this.type=i,this.color=s,this.energy=t,this.htmlElement=v(),this.htmlElement.classList.add("cell"),this.render(),d.append(this.htmlElement),x.push(this)}update(){if(this.type===f.Rock)return;if(this.energy<50)return void this.dieCell();let e=this.getCellNeighbours();switch(this.decideCellAction(e)){case p.Rest:this.restCell();break;case p.MoveRight:this.moveCell(this.vector.x+1,this.vector.y);break;case p.MoveUp:this.moveCell(this.vector.x,this.vector.y-1);break;case p.MoveLeft:this.moveCell(this.vector.x-1,this.vector.y);break;case p.MoveDown:this.moveCell(this.vector.x,this.vector.y+1);break;case p.SplitRight:this.splitCell(this.vector.x+1,this.vector.y);break;case p.SplitLeft:this.splitCell(this.vector.x-1,this.vector.y);break;case p.SplitDown:this.splitCell(this.vector.x,this.vector.y+1);break;case p.SplitUp:this.splitCell(this.vector.x,this.vector.y-1);break;case p.EatRight:this.eatCell(this.vector.x+1,this.vector.y);break;case p.EatLeft:this.eatCell(this.vector.x-1,this.vector.y);break;case p.EatUp:this.eatCell(this.vector.x,this.vector.y-1);break;case p.EatDown:this.eatCell(this.vector.x,this.vector.y+1);break;case p.FeedRight:this.feedCell(this.vector.x+1,this.vector.y);break;case p.FeedLeft:this.feedCell(this.vector.x-1,this.vector.y);break;case p.FeedUp:this.feedCell(this.vector.x,this.vector.y-1);break;case p.FeedDown:this.feedCell(this.vector.x,this.vector.y+1)}}render(){this.htmlElement.style.left=this.vector.x*this.width+"px",this.htmlElement.style.top=this.vector.y*this.height+"px",this.htmlElement.style.transform=`scale(${this.energy/g})`,this.htmlElement.style.backgroundColor=this.color,this.htmlElement.style.opacity=""+this.energy/g}dieCell(){let e=x.indexOf(this);d.removeChild(this.htmlElement),x.splice(e,1),this.render()}restCell(){if(this.energy===g)return;let e=8-this.getCellNeighbours().length,t=e>=3?5*e:1;this.energy+=t,this.energy>g&&(this.energy=g)}getCellNeighbours(){return x.filter((e=>e.vector.x>=this.vector.x-1&&e.vector.x<=this.vector.x+1&&e.vector.y>=this.vector.y-1&&e.vector.y<=this.vector.y+1&&e.vector.y!=this.vector.y&&e.vector.x!=this.vector.x))}moveCell(e,t){this.isCellPositionFree(e,t)&&(this.vector.x<e?this.vector.x+=1:this.vector.x>e?this.vector.x-=1:this.vector.y<t?this.vector.y+=1:this.vector.y>t&&(this.vector.y-=1))}splitCell(e,t){e<=w&&t<=m&&e>=0&&t>=0&&this.energy>=100&&this.isCellPositionFree(e,t)&&new E(new c(e,t),this.energy/2,this.type,this.color)}isCellPositionFree(e,t){return!x.some((i=>i.vector.x==e&&i.vector.y==t))}eatCell(e,t){let i=this.getCell(e,t);void 0!==i&&(this.energy+=10,i.energy-=10,this.energy>g&&(this.energy=g))}feedCell(e,t){let i=this.getCell(e,t);void 0!==i&&(this.energy-=10,i.energy+=10,i.energy>g&&(i.energy=g))}getCell(e,t){return x.find((i=>i.vector.x==e&&i.vector.y==t&&i.type==f.Player))}decideCellAction(e){if(this.energy<110)return p.Rest;let t=[p.EatUp,p.EatDown,p.EatLeft,p.EatRight];if(e.some((e=>e.color!=this.color&&e.type==f.Player)))return t[Math.floor(Math.random()*t.length)];let i=[p.MoveUp,p.MoveDown,p.MoveLeft,p.MoveRight];if(e.length<2&&Math.random()<.5)return i[Math.floor(Math.random()*i.length)];let s=[p.Rest,p.Rest,p.MoveUp,p.MoveDown,p.MoveLeft,p.MoveRight,p.SplitRight,p.SplitLeft,p.SplitUp,p.SplitDown];return s[Math.floor(Math.random()*s.length)]}}!function(i,{contextless:s=!1}={}){if(e=document.getElementById(i)||i||document.querySelector("canvas"),s&&(e=e||new Proxy({},r)),!e)throw Error("You must provide a canvas element for the game");t=e.getContext("2d")||new Proxy({},r),t.imageSmoothingEnabled=!1,n("init")}();let C=0,k=0;(function({fps:e=60,clearCanvas:t=!0,update:r=i,render:h,context:l=o(),blur:c=!1}={}){if(!h)throw Error("You must provide a render() function");let v,d,y,p,w,m=0,g=1e3/e,u=1/e,f=t?a:i,x=!0;function E(){if(d=requestAnimationFrame(E),x&&(y=performance.now(),p=y-v,v=y,!(p>1e3))){for(n("tick"),m+=p;m>=g;)w.update(u),m-=g;f(w.context),w.render()}}return c||(window.addEventListener("focus",(()=>{x=!0})),window.addEventListener("blur",(()=>{x=!1}))),k=()=>{w.context??=o()},s[C="init"]=s[C]||[],s[C].push(k),w={update:r,render:h,isStopped:!0,context:l,start(){v=performance.now(),this.isStopped=!1,requestAnimationFrame(E)},stop(){this.isStopped=!0,cancelAnimationFrame(d)},_frame:E,set _last(e){v=e}},w;var C,k})({update:function(){C++,C%10==0&&x.forEach((e=>e.update())),C>=60&&(C=0)},render:function(){k++,C%10==0&&x.forEach((e=>e.render())),C>=60&&(C=0)}}).start();const R=document.getElementById("game-container");let M=1;function b(){C=0,k=0,x.length=0,d.innerHTML=""}document.addEventListener("wheel",(function(e){e.deltaY>0?R.style.transform=`scale(${M+=.5})`:R.style.transform=`scale(${M-=.5})`})),document.getElementsByClassName("gameOver")[0].addEventListener("click",(e=>b())),document.getElementsByClassName("level1")[0].addEventListener("click",(e=>(b(),u.setMapSize(50,50),new E(new c(10,10),50,f.Player),new E(new c(40,40),50,f.Player,"#009dff"),new E(new c(10,40),50,f.Player,"#07ff07"),void new E(new c(40,10),50,f.Player,"#ffc500")))),document.getElementsByClassName("level2")[0].addEventListener("click",(e=>(b(),u.setMapSize(50,50),new E(new c(24,24),100,f.Player),void new E(new c(26,26),100,f.Player,"#07ff07")))),document.getElementsByClassName("level3")[0].addEventListener("click",(e=>(u.setMapSize(5,5),b(),new E(new c(0,0),100,f.Player),new E(new c(5,5),100,f.Player,"#07ff07"),new E(new c(0,2),200,f.Rock,"#000000"),new E(new c(0,3),200,f.Rock,"#000000"),new E(new c(0,4),200,f.Rock,"#000000"),new E(new c(0,5),200,f.Rock,"#000000"),new E(new c(1,2),200,f.Rock,"#000000"),new E(new c(1,3),200,f.Rock,"#000000"),new E(new c(1,4),200,f.Rock,"#000000"),new E(new c(1,5),200,f.Rock,"#000000"),new E(new c(4,2),200,f.Rock,"#000000"),new E(new c(4,3),200,f.Rock,"#000000"),new E(new c(5,0),200,f.Rock,"#000000"),new E(new c(5,1),200,f.Rock,"#000000"),new E(new c(5,2),200,f.Rock,"#000000"),void new E(new c(5,3),200,f.Rock,"#000000"))))})();